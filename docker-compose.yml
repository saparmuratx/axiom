services:
  auth_service:
    build:
      context: ./auth
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:8000:8000"
    env_file:
      - ./auth/.env
    
  auth_db:
    image: postgres:18
    env_file:
    - ./auth/.env.postgres
    volumes:
      - auth-db-data:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5432:5432"

  library_service:
    build:
      context: ./library
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:8001:8001"
    env_file:
      - ./library/.env
    
  library_db:
    image: postgres:18
    env_file:
    - ./library/.env.postgres
    volumes:
      - library-db-data:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5433:5432"

  pypiserver:
    image: pypiserver/pypiserver:latest
    volumes:
      - pypivolume:/data/packages
    
    ports:
      - "127.0.0.1:8080:8080"

volumes:
  auth-db-data:
  library-db-data:
  pypivolume: